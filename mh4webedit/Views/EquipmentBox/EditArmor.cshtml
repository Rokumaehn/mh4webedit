@model mh4webedit.Models.EquipEditorArmorViewModel

<h2>Armor Editor</h2>

<form asp-action="EditArmor" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Index" />
    <input type="hidden" asp-for="Type" />
    <input type="hidden" asp-for="ReturnPage" />

    <div class="mb-3">
        <label class="form-label">Armor</label>
        <select asp-for="ID" class="form-select">
            @{
                string[] list = Model.Type switch
                {
                    1 => MonHunEquipStatic.allEqpChest,
                    2 => MonHunEquipStatic.allEqpArms,
                    3 => MonHunEquipStatic.allEqpWaist,
                    4 => MonHunEquipStatic.allEqpLegs,
                    5 => MonHunEquipStatic.allEqpHeads,
                    _ => MonHunEquipStatic.allEqpChest
                };

                for (int i = 0; i < list.Length; i++)
                {
                    @if(Model.ID == i)
                    {
                        <option value="@i" selected>@list[i]</option>
                    }
                    else
                    {
                        <option value="@i">@list[i]</option>
                    }
                }
            }
        </select>
    </div>

    <div class="row">
        <div class="col-md-4">
            <label class="form-label">Slot 1 (Jewel)</label>
                <select asp-for="Slot1" class="form-select jewel-select" data-current="@Model.Slot1"></select>
            <div class="form-check mt-1"><input asp-for="Slot1Fixed" class="form-check-input" /> <label class="form-check-label">Fixed</label></div>
        </div>
        <div class="col-md-4">
            <label class="form-label">Slot 2 (Jewel)</label>
                <select asp-for="Slot2" class="form-select jewel-select" data-current="@Model.Slot2"></select>
            <div class="form-check mt-1"><input asp-for="Slot2Fixed" class="form-check-input" /> <label class="form-check-label">Fixed</label></div>
        </div>
        <div class="col-md-4">
            <label class="form-label">Slot 3 (Jewel)</label>
                <select asp-for="Slot3" class="form-select jewel-select" data-current="@Model.Slot3"></select>
            <div class="form-check mt-1"><input asp-for="Slot3Fixed" class="form-check-input" /> <label class="form-check-label">Fixed</label></div>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-3">
            <label class="form-label">Upgrade Level</label>
            <select asp-for="Upgrade" class="form-select upgrade-select" data-current="@Model.Upgrade"></select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Resistances</label>
            <select asp-for="Resistances" class="form-select resistance-select" data-current="@Model.Resistances"></select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Defense</label>
            <select asp-for="Defense" class="form-select defense-select" data-current="@Model.Defense"></select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Num Slots</label>
            <select asp-for="NumSlots" class="form-select slots-select" data-current="@Model.NumSlots"></select>
        </div>
    </div>

    <div class="form-check mt-3">
        <input asp-for="Polished" class="form-check-input" /> <label class="form-check-label">Polished</label>
    </div>
    <div class="form-check">
        <input asp-for="Glow" class="form-check-input" /> <label class="form-check-label">Glow</label>
    </div>

    <div class="row mt-3">
        <div class="col-md-3">
            <label class="form-label">Rarity</label>
            <select asp-for="Rarity" class="form-select rarity-select" data-current="@Model.Rarity"></select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Polish Req</label>
            <select asp-for="PolishReq" class="form-select polish-select" data-current="@Model.PolishReq"></select>
        </div>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-success">Save</button>
        <a asp-action="EditType" asp-route-page="@Model.ReturnPage" asp-route-index="@Model.Index" class="btn btn-outline-primary ms-2">Change Type</a>
        <a asp-action="Index" asp-route-page="@Model.ReturnPage" class="btn btn-secondary ms-2">Back</a>
    </div>
</form>

<template id="jewel-options" style="display:none">
    @foreach(var s in MonHunEquipStatic.Slot1Values)
    {
        <option value="@s.Slot1">@s.Display</option>
    }
</template>

<template id="resistance-options" style="display:none">
    @foreach(var r in MonHunEquipStatic.ResistancesValues)
    {
        <option value="@r.Resistances">@r.Display</option>
    }
</template>

<template id="defense-options" style="display:none">
    @foreach(var d in MonHunEquipStatic.DefenseValues)
    {
        <option value="@d.Defense">@d.Display</option>
    }
</template>

<template id="upgrade-options" style="display:none">
    @for (int i = 0; i <= 12; i++)
    {
        <option value="@i">@i</option>
    }
</template>

<template id="slots-options" style="display:none">
    @for (int i = 0; i <= 3; i++)
    {
        <option value="@i">@i</option>
    }
</template>

<template id="rarity-options" style="display:none">
    @for (int i = 1; i <= 10; i++)
    {
        <option value="@i">@i</option>
    }
</template>

<template id="polish-options" style="display:none">
    @for (int i = 0; i <= 4; i++)
    {
        <option value="@i">@i</option>
    }
</template>

<script>
    (function(){
        const jewelTmpl = document.getElementById('jewel-options').innerHTML;
        document.querySelectorAll('select.jewel-select').forEach(function(sel){
            sel.innerHTML = jewelTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const resTmpl = document.getElementById('resistance-options').innerHTML;
        document.querySelectorAll('select.resistance-select').forEach(function(sel){
            sel.innerHTML = resTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const defTmpl = document.getElementById('defense-options').innerHTML;
        document.querySelectorAll('select.defense-select').forEach(function(sel){
            sel.innerHTML = defTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const upgTmpl = document.getElementById('upgrade-options').innerHTML;
        document.querySelectorAll('select.upgrade-select').forEach(function(sel){
            sel.innerHTML = upgTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const slotsTmpl = document.getElementById('slots-options').innerHTML;
        document.querySelectorAll('select.slots-select').forEach(function(sel){
            sel.innerHTML = slotsTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const rarityTmpl = document.getElementById('rarity-options').innerHTML;
        document.querySelectorAll('select.rarity-select').forEach(function(sel){
            sel.innerHTML = rarityTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });

        const polishTmpl = document.getElementById('polish-options').innerHTML;
        document.querySelectorAll('select.polish-select').forEach(function(sel){
            sel.innerHTML = polishTmpl;
            const cur = sel.getAttribute('data-current');
            if(cur !== null && cur !== ''){
                const opt = sel.querySelector('option[value="'+cur+'"]');
                if(opt) opt.selected = true;
            }
        });
    })();
</script>
